<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ø§ÙˆØ¬Ø¯ Ø§Ù„Ù…Ø®ØªÙ„Ù</title>
  <style>
    :root{
      --bg:#071028;
      --card:#071228;
      --accent:#60a5fa;
      --text:#e6eef8;
    }
    *{box-sizing:border-box;font-family:Tahoma, Arial, sans-serif}
    body{
      margin:0;
      min-height:100vh;
      background:linear-gradient(180deg,#071030 0%,#081025 100%);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .app{
      width:100%;
      max-width:920px;
      background:rgba(255,255,255,0.03);
      border-radius:16px;
      padding:18px;
      box-shadow:0 10px 30px rgba(2,6,23,0.6);
    }
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button{
      background:var(--accent);
      border:none;
      color:#04263b;
      padding:8px 12px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
    }
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--text)}
    .meta{display:flex;gap:12px;align-items:center}
    .board-wrap{display:flex;gap:18px;flex-wrap:wrap;justify-content:center}
    .board{
      background:rgba(255,255,255,0.02);
      padding:12px;
      border-radius:12px;
      display:grid;
      gap:8px;
      width:100%;
      max-width:720px;
    }
    .cell{
      width:56px;height:56px;border-radius:8px;display:flex;align-items:center;justify-content:center;
      cursor:pointer;user-select:none;transition:transform .12s ease,box-shadow .12s,outline .12s;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
    }
    .cell:active{transform:scale(.97)}
    .info{margin-top:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .pill{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    .message{margin-top:12px;padding:10px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));font-size:14px}
    @media(min-width:720px){.cell{width:68px;height:68px}}
    .flash{
      outline: 3px solid rgba(255,255,255,0.55);
      transform: scale(1.03);
    }
    .correct{
      outline: 3px solid rgba(0,255,150,0.7) !important;
      box-shadow: 0 8px 24px rgba(0,255,150,0.06);
    }
    .wrong{
      outline: 3px solid rgba(255,80,80,0.8) !important;
      filter: saturate(.6) brightness(.9);
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Ù„Ø¹Ø¨Ø© Ø§ÙˆØ¬Ø¯ Ø§Ù„Ù…Ø®ØªÙ„Ù">
    <header>
      <h1>Ù„Ø¹Ø¨Ø©: Ø§ÙˆØ¬Ø¯ Ø§Ù„Ù…Ø®ØªÙ„Ù ğŸ”</h1>
      <div class="controls">
        <div class="meta" aria-hidden="false">
          <div class="pill">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <strong id="level">1</strong></div>
          <div class="pill">Ø§Ù„ÙˆÙ‚Øª: <strong id="time">30</strong> Ø«</div>
          <div class="pill">Ø§Ù„Ù†Ù‚Ø§Ø·: <strong id="score">0</strong></div>
        </div>
        <button id="restart">Ø¥Ø¹Ø§Ø¯Ø©</button>
        <button id="hint" class="secondary">Ù…Ø¹Ù„ÙˆÙ…Ø©</button>
      </div>
    </header>

    <main>
      <div class="board-wrap">
        <div id="board" class="board" style="grid-template-columns: repeat(4,1fr)"></div>
      </div>

      <div class="info">
        <div class="pill">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù: <span id="diffType">Ù„ÙˆÙ†</span></div>
        <div class="pill">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span id="tries">3</span></div>
      </div>

      <div class="message" id="message">Ø§Ø¶ØºØ· Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø®ØªÙ„Ù Ù‚Ø¨Ù„ Ù†ÙØ§Ø¯ Ø§Ù„ÙˆÙ‚Øª!</div>
    </main>
  </div>

  <script>
    // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    const board = document.getElementById('board');
    const levelEl = document.getElementById('level');
    const timeEl = document.getElementById('time');
    const scoreEl = document.getElementById('score');
    const message = document.getElementById('message');
    const diffTypeEl = document.getElementById('diffType');
    const triesEl = document.getElementById('tries');

    const restartBtn = document.getElementById('restart');
    const hintBtn = document.getElementById('hint');

    // Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
    let level = 1;
    let score = 0;
    let timeLeft = 30;
    let timer = null;
    let tries = 3;
    let correctIndex = null;
    let locked = false; // Ù„Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„

    const diffTypes = ['Ù„ÙˆÙ†','Ø²Ø§ÙˆÙŠØ©','Ø­Ø¬Ù…','Ø¸Ù„'];

    // Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
    function startLevel(){
      locked = false;
      clearInterval(timer);
      timeLeft = Math.max(8, 30 - Math.floor(level * 0.8)); // ÙŠÙ‚Ù„ Ø§Ù„ÙˆÙ‚Øª Ù…Ø¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
      levelEl.textContent = level;
      scoreEl.textContent = score;
      timeEl.textContent = timeLeft;
      triesEl.textContent = tries;

      // Ø­Ø³Ø§Ø¨ Ø­Ø¬Ù… Ø§Ù„Ø´Ø¨ÙƒØ© (ÙŠØ²ÙŠØ¯ Ø¨ØµØ¹ÙˆØ¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰)
      const base = Math.min(2 + Math.floor(level / 1.25), 10); // Ø­Ø¯ÙˆØ¯ Ù„ØªÙØ§Ø¯ÙŠ ØµÙ ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹
      const cols = base;
      const rows = base;
      board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      board.innerHTML = '';

      // Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù
      const diffType = diffTypes[(level-1) % diffTypes.length];
      diffTypeEl.textContent = diffType;

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ù„ÙˆÙ† Ø£Ø³Ø§Ø³ÙŠ
      const baseHue = Math.floor(Math.random()*360);
      const baseSat = 55 + Math.floor(Math.random()*20);
      const baseLight = 40 + Math.floor(Math.random()*12);

      const total = cols * rows;
      correctIndex = Math.floor(Math.random()*total);

      for(let i=0;i<total;i++){
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.index = i;

        // Ø®ØµØ§Ø¦Øµ Ù…ØªØºÙŠØ±Ø© Ø®ÙÙŠÙØ© Ù„ØªØ¬Ù†Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ØªØ·Ø§Ø¨Ù‚Ø© ØªÙ…Ø§Ù…Ù‹Ø§
        const hue = baseHue + Math.floor((Math.random()-0.5)*6);
        const sat = baseSat + (Math.random()*6-3);
        const light = baseLight + (Math.random()*6-3);

        if(i == correctIndex){
          // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
          if(diffType === 'Ù„ÙˆÙ†'){
            // Ø®Ù„ÙŠ Ø§Ù„Ù…Ø®ØªÙ„Ù Ø£Ù‚Ø±Ø¨ Ù„ÙƒÙ† Ù…Ù„Ø­ÙˆØ¸
            cell.style.background = `hsl(${hue+10}, ${Math.max(30,sat)}%, ${Math.min(light+12,92)}%)`;
          } else if(diffType === 'Ø²Ø§ÙˆÙŠØ©'){
            cell.style.background = `hsl(${hue}, ${sat}%, ${light}%)`;
            cell.style.transform = 'rotate(8deg)';
          } else if(diffType === 'Ø­Ø¬Ù…'){
            cell.style.background = `hsl(${hue}, ${sat}%, ${light}%)`;
            // Ù†Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£ØµØºØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„ÙŠØ©
            const inner = document.createElement('div');
            inner.style.width = '78%';
            inner.style.height = '78%';
            inner.style.borderRadius = '6px';
            inner.style.background = `hsl(${hue}, ${sat}%, ${light}%)`;
            inner.style.boxShadow = '0 6px 16px rgba(0,0,0,0.25)';
            cell.appendChild(inner);
          } else { // Ø¸Ù„
            cell.style.background = `linear-gradient(180deg,hsl(${hue}, ${sat}%, ${light}%), hsl(${hue}, ${sat}%, ${Math.max(light-10,0)}%))`;
            cell.style.boxShadow = '0 8px 20px rgba(0,0,0,0.45)';
          }
          cell.dataset.correct = '1';
        } else {
          // Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
          cell.style.background = `hsl(${hue}, ${sat}%, ${light}%)`;
        }

        cell.addEventListener('click', onCellClick);
        board.appendChild(cell);
      }

      // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
      timer = setInterval(() => {
        timeLeft--;
        timeEl.textContent = timeLeft;
        if(timeLeft <= 0){
          clearInterval(timer);
          onTimeUp();
        }
      }, 1000);

      message.textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level} â€” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø®ØªÙ„Ù!`;
    }

    // Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
    function onTimeUp(){
      locked = true;
      tries--;
      triesEl.textContent = tries;
      message.textContent = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø®Ø³Ø±Øª Ù…Ø­Ø§ÙˆÙ„Ø©.';
      flashCorrect();

      if(tries <= 0){
        endGame(false);
      } else {
        // Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ† Ø§Ø¨Ø¯Ø£ Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù…Ø¬Ø¯Ø¯Ø§Ù‹
        setTimeout(() => {
          startLevel();
        }, 1200);
      }
    }

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø®Ù„ÙŠØ©
    function onCellClick(e){
      if(locked) return;
      const cell = e.currentTarget;
      const isCorrect = cell.dataset.correct === '1';

      if(isCorrect){
        // ÙØ§Ø² Ø¨Ø§Ù„Ù…Ø³ØªÙˆÙ‰
        locked = true;
        cell.classList.add('correct');
        score += Math.max(10, Math.floor(50 / Math.sqrt(level))); // Ù†Ù‚Ø§Ø· Ø£Ù‚Ù„ ÙƒÙ„Ù…Ø§ Ø²Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ø´ÙƒÙ„ Ø·ÙÙŠÙ
        scoreEl.textContent = score;
        message.textContent = 'ØµØ­ÙŠØ­! ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ.';
        clearInterval(timer);
        // ØªØ£Ø«ÙŠØ± Ù‚ØµÙŠØ± Ø«Ù… Ø§Ù„ØªØ§Ù„ÙŠ
        setTimeout(() => {
          level++;
          startLevel();
        }, 800);
      } else {
        // Ø®Ø·Ø£
        cell.classList.add('wrong');
        locked = true;
        tries--;
        triesEl.textContent = tries;
        message.textContent = 'Ø®Ø·Ø£! Ø®Ø³Ø±Øª Ù…Ø­Ø§ÙˆÙ„Ø©.';
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ Ù…Ø¹ ÙˆÙ…ÙŠØ¶
        flashCorrect();
        clearInterval(timer);
        if(tries <= 0){
          setTimeout(()=> endGame(false), 900);
        } else {
          setTimeout(()=> {
            // Ø£Ø¹Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
            startLevel();
          }, 900);
        }
      }
    }

    // Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø®Ù„ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ø¨Ø¶Ø¹ Ù„Ø­Ø¸Ø§Øª
    function flashCorrect(){
      const cells = board.querySelectorAll('.cell');
      if(correctIndex === null) return;
      const correctCell = Array.from(cells).find(c => Number(c.dataset.index) === Number(correctIndex));
      if(!correctCell) return;
      correctCell.classList.add('flash');
      setTimeout(()=> {
        correctCell.classList.remove('flash');
      }, 900);
    }

    // Ø²Ø± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© (hint): ÙŠÙ„Ù…Ù‘Ø¹ Ø§Ù„Ø®Ù„ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù…Ø¯Ø© Ù‚ØµÙŠØ±Ø© Ù„ÙƒÙ† ÙŠÙ‚Ù„Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· Ù‚Ù„ÙŠÙ„Ø§Ù‹
    hintBtn.addEventListener('click', () => {
      if(locked) return;
      score = Math.max(0, score - 5);
      scoreEl.textContent = score;
      flashCorrect();
      message.textContent = 'ØªÙ„Ù…ÙŠØ­ Ù…Ø³ØªØ®Ø¯Ù… (Ø®ØµÙ… 5 Ù†Ù‚Ø§Ø·)';
    });

    // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
    restartBtn.addEventListener('click', () => {
      clearInterval(timer);
      level = 1;
      score = 0;
      tries = 3;
      correctIndex = null;
      message.textContent = 'Ø§Ù„Ù„Ø¹Ø¨Ø© Ø£Ø¹ÙŠØ¯Øª. Ø­Ø¸Ø§Ù‹ Ø³Ø¹ÙŠØ¯Ø§Ù‹!';
      startLevel();
    });

    // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
    function endGame(won){
      clearInterval(timer);
      locked = true;
      if(won){
        message.textContent = `ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ù„Ø¹Ø¨Ø©. Ù†Ù‚Ø§Ø·Ùƒ: ${score}`;
      } else {
        message.textContent = `Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª â€” Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù†ØªÙ‡Øª. Ù†Ù‚Ø§Ø·Ùƒ: ${score}`;
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
        const cells = board.querySelectorAll('.cell');
        const correctCell = Array.from(cells).find(c => Number(c.dataset.index) === Number(correctIndex));
        if(correctCell) correctCell.classList.add('correct');
      }
    }

    // Ø§Ø¨Ø¯Ø£ Ø£ÙˆÙ„ Ù…Ø³ØªÙˆÙ‰ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    startLevel();

    // ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØµÙˆÙ„: Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ÙƒÙŠØ² Ù„ÙˆØ­Ø© Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('keydown', (e) => {
      if(e.key === 'r' || e.key === 'R') {
        restartBtn.click();
      } else if(e.key === 'h' || e.key === 'H') {
        hintBtn.click();
      }
    });
  </script>
</body>
</html>
